/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var w=(r,e)=>{for(var t in e)b(r,t,{get:e[t],enumerable:!0})},S=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of L(e))!M.call(r,n)&&n!==t&&b(r,n,{get:()=>e[n],enumerable:!(i=y(e,n))||i.enumerable});return r};var P=r=>S(b({},"__esModule",{value:!0}),r);var T={};w(T,{BlurPlugin:()=>m,default:()=>m});module.exports=P(T);var v=require("obsidian");var f={blurAmount:"0.5em",isSelectingMode:!1,isBlurActive:!1,presets:[],keywords:[],isDebugMode:!1};var E=require("obsidian");var o=class{static isEditorElement(e){return e.classList.contains("cm-editor")||e.classList.contains("markdown-preview-view")||e.closest(".cm-editor")!==null||e.closest(".markdown-preview-view")!==null}static isRibbonElement(e){return e.classList.contains("ribbon-tab")||e.closest(".ribbon-tab")!==null||e.classList.contains("side-dock-ribbon")||e.closest(".side-dock-ribbon")!==null}static isManagePanelElement(e){return e.closest(".blur-manage-panel")!==null}static getElementSelector(e){if(o.isEditorElement(e)){let i=Array.from(e.classList).filter(n=>!n.startsWith("blur-plugin-"));if(i.length>0)return"."+i.join(".")}if(e.id)return`#${e.id}`;if(e.className){let i=(typeof e.className=="string"?e.className:e.classList.toString()).split(" ").filter(n=>!n.startsWith("blur-plugin-")).filter(Boolean);if(i.length>0)return"."+i.join(".")}return null}};var p=class{constructor(e){this.plugin=e,this.plugin.registerDomEvent(document,"mouseover",this.handleMouseOver.bind(this)),this.plugin.registerDomEvent(document,"mouseout",this.handleMouseOut.bind(this))}handleMouseOver(e){if(!this.plugin.settings.isSelectingMode)return;let t=e.target;t&&!this.plugin.isManagePanelElement(t)&&!this.plugin.isRibbonElement(t)&&t.classList.add("blur-plugin-selecting")}handleMouseOut(e){if(!this.plugin.settings.isSelectingMode)return;let t=e.target;t&&t.classList.remove("blur-plugin-selecting")}applyBlurEffects(){this.plugin.logger.debug("Applying blur effects with presets:",this.plugin.settings.presets);let e=this.plugin.settings.blurAmount.includes("em")?this.plugin.settings.blurAmount:`${this.plugin.settings.blurAmount}em`;document.documentElement.style.setProperty("--blur-amount",e),this.plugin.settings.presets.forEach(t=>{this.plugin.logger.debug("Processing selector:",t);let i=document.querySelectorAll(t);this.plugin.logger.debug("Found elements:",i.length),i.forEach(n=>{if(n&&!this.plugin.isManagePanelElement(n)){let s=n;if(this.plugin.isEditorElement(s))s.classList.add("blur-plugin-editor");else{let l=s.tagName.toLowerCase();["h1","h2","h3","h4"].includes(l)?s.classList.add(`blur-${l}`):s.classList.add("blur-element")}}})}),this.plugin.settings.keywords.length>0&&this.applyKeywordBlur()}removeBlurEffects(){document.documentElement.style.removeProperty("--blur-amount");let e=["blur-plugin-editor","blur-h1","blur-h2","blur-h3","blur-h4","blur-element","blur-keyword"];document.querySelectorAll(e.map(t=>`.${t}`).join(",")).forEach(t=>{e.forEach(i=>{t.classList.remove(i)})})}applyKeywordBlur(){if(!this.plugin.settings.keywords.length)return;let e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:function(n){let s=n.parentElement;return(s==null?void 0:s.tagName)==="SCRIPT"||(s==null?void 0:s.tagName)==="STYLE"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),t=[],i;for(;(i=e.nextNode())!==null;)t.push(i);t.forEach(n=>{let s=n.textContent||"";if(this.plugin.settings.keywords.some(l=>s.includes(l))){let l=n.parentElement;l&&!this.plugin.isManagePanelElement(l)&&!this.plugin.isRibbonElement(l)&&(this.plugin.isEditorElement(l)?l.classList.add("blur-plugin-editor"):l.classList.add("blur-keyword"))}})}async togglePresetElement(e){if(!e||e===document.body||this.plugin.isRibbonElement(e)||this.plugin.isManagePanelElement(e))return;let t=o.getElementSelector(e);if(!t)return;e.classList.remove("blur-plugin-selecting","blur-plugin-hover");let i=this.plugin.settings.presets.indexOf(t);if(i===-1){if(this.plugin.settings.presets.push(t),new E.Notice("Added element to presets"),e.classList.add("blur-plugin-preset"),this.plugin.blurPanel){let n=this.plugin.blurPanel.containerEl.querySelector(".selector-container");n&&this.plugin.blurPanel.updatePresetList(n)}}else if(this.plugin.settings.presets.splice(i,1),new E.Notice("Removed element from presets"),e.classList.remove("blur-plugin-preset"),this.plugin.blurPanel){let n=this.plugin.blurPanel.containerEl.querySelector(".selector-container");n&&this.plugin.blurPanel.updatePresetList(n)}await this.plugin.saveSettings(),this.plugin.settings.isBlurActive&&this.applyBlurEffects()}removeAllHighlights(){document.querySelectorAll(".blur-plugin-selecting, .blur-plugin-preset, .blur-plugin-hover").forEach(e=>{e.classList.remove("blur-plugin-selecting","blur-plugin-preset","blur-plugin-hover")})}};var u=class{constructor(e){this.initialX=0;this.initialY=0;this.currentX=0;this.currentY=0;this.xOffset=20;this.yOffset=50;this.active=!1;this.plugin=e,this.containerEl=document.createElement("div"),this.containerEl.addClass("blur-manage-panel"),this.dragHandle=this.containerEl.createDiv("blur-panel-handle"),this.dragHandle.setText("Blur management");let t=this.dragHandle.createEl("span",{text:"\xD7"});t.addClass("blur-panel-close"),t.addEventListener("click",()=>{this.plugin.blurPanel&&(this.plugin.blurPanel.close(),this.plugin.blurPanel=null,this.plugin.settings.isSelectingMode=!1,this.plugin.blurManager.removeAllHighlights(),this.plugin.saveSettings())});let i=this.containerEl.createDiv("blur-panel-tabs"),n=i.createDiv("blur-panel-tab active");n.setText("CSS Selector");let s=i.createDiv("blur-panel-tab");s.setText("Keywords");let l=this.containerEl.createDiv("blur-panel-content"),a=l.createDiv("selector-container");this.updatePresetList(a);let g=l.createDiv("keyword-container");g.classList.add("panel-container-hidden"),this.createKeywordUI(g),n.addEventListener("click",()=>{n.addClass("active"),s.removeClass("active"),a.classList.remove("panel-container-hidden"),a.classList.add("panel-container-visible"),g.classList.remove("panel-container-visible"),g.classList.add("panel-container-hidden")}),s.addEventListener("click",()=>{s.addClass("active"),n.removeClass("active"),g.classList.remove("panel-container-hidden"),g.classList.add("panel-container-visible"),a.classList.remove("panel-container-visible"),a.classList.add("panel-container-hidden")}),this.setTranslate(this.xOffset,this.yOffset),this.setupDrag(),this.containerEl.classList.add("panel-draggable"),this.containerEl.style.setProperty("--panel-x","0px"),this.containerEl.style.setProperty("--panel-y","0px")}setupDrag(){this.dragHandle.addEventListener("mousedown",this.dragStart.bind(this),!1),this.plugin.registerDomEvent(document,"mousemove",this.drag.bind(this)),this.plugin.registerDomEvent(document,"mouseup",this.dragEnd.bind(this))}dragStart(e){if(e.target===this.dragHandle){let t=this.containerEl.getBoundingClientRect();this.initialX=e.clientX-t.left,this.initialY=e.clientY-t.top,e.target===this.dragHandle&&(this.active=!0)}}drag(e){if(this.active){e.preventDefault();let t=e.clientX-this.initialX,i=e.clientY-this.initialY,n=window.innerWidth-this.containerEl.offsetWidth,s=window.innerHeight-this.containerEl.offsetHeight;this.xOffset=Math.min(Math.max(0,t),n),this.yOffset=Math.min(Math.max(0,i),s),this.setTranslate(this.xOffset,this.yOffset)}}dragEnd(){this.initialX=this.currentX,this.initialY=this.currentY,this.active=!1}setTranslate(e,t){this.currentX=e,this.currentY=t,this.containerEl.style.setProperty("--panel-x",`${e}px`),this.containerEl.style.setProperty("--panel-y",`${t}px`),this.containerEl.classList.add("panel-draggable")}updatePresetList(e){if(e.empty(),this.plugin.settings.presets.length===0)e.createEl("p",{text:"No elements selected"});else{let t=e.createEl("ul");t.addClass("preset-list"),this.plugin.settings.presets.forEach((i,n)=>{let s=t.createEl("li");s.addClass("preset-item"),s.createSpan({text:i}).addClass("preset-selector");let a=s.createEl("span",{text:"\xD7"});a.addClass("preset-delete-btn"),this.setupPresetItemEvents(s,i,a,n)})}}setupPresetItemEvents(e,t,i,n){this.plugin.registerDomEvent(e,"mouseenter",()=>{let s=document.querySelector(t);s instanceof HTMLElement&&(s.classList.remove("blur-plugin-preset"),s.classList.add("blur-plugin-hover"))}),this.plugin.registerDomEvent(e,"mouseleave",()=>{let s=document.querySelector(t);s instanceof HTMLElement&&(s.classList.remove("blur-plugin-hover"),s.classList.add("blur-plugin-preset"))}),this.plugin.registerDomEvent(i,"click",async()=>{let s=document.querySelector(t);s instanceof HTMLElement&&s.classList.remove("blur-plugin-preset","blur-plugin-hover","blur-plugin-selecting"),this.plugin.settings.presets.splice(n,1),await this.plugin.saveSettings(),this.updatePresetList(this.containerEl.querySelector(".selector-container")),this.plugin.settings.presets.length===0&&document.querySelectorAll(".blur-plugin-preset, .blur-plugin-hover, .blur-plugin-selecting").forEach(l=>{l.classList.remove("blur-plugin-preset","blur-plugin-hover","blur-plugin-selecting")}),this.plugin.settings.isBlurActive&&this.plugin.blurManager.applyBlurEffects()})}createKeywordUI(e){let t=e.createDiv("keyword-input-container"),i=t.createEl("input",{type:"text",placeholder:"Enter keyword"});t.createEl("button",{text:"Add",cls:"keyword-add-button"}).addEventListener("click",async()=>{let l=i.value.trim();l&&!this.plugin.settings.keywords.includes(l)&&(this.plugin.settings.keywords.push(l),await this.plugin.saveSettings(),this.updateKeywordsList(e.querySelector(".keyword-list-container")),i.value="",this.plugin.settings.isBlurActive&&this.plugin.blurManager.applyBlurEffects())});let s=e.createDiv("keyword-list-container");this.updateKeywordsList(s)}updateKeywordsList(e){if(e.empty(),this.plugin.settings.keywords.length===0){e.createEl("p",{text:"No keywords added"});return}let t=e.createEl("ul");t.addClass("keyword-list"),this.plugin.settings.keywords.forEach((i,n)=>{let s=t.createEl("li");s.addClass("keyword-item"),s.createSpan({text:i}).addClass("keyword-text");let a=s.createEl("span",{text:"\xD7"});a.addClass("keyword-delete-btn"),a.addEventListener("click",async()=>{this.plugin.settings.keywords.splice(n,1),await this.plugin.saveSettings(),this.updateKeywordsList(e),this.plugin.settings.isBlurActive&&this.plugin.blurManager.applyBlurEffects()})})}open(){document.body.appendChild(this.containerEl)}close(){this.containerEl.remove(),this.plugin.blurPanel=null,this.plugin.settings.isSelectingMode=!1,this.clearAllHighlights(),this.plugin.saveSettings()}clearAllHighlights(){this.plugin.blurManager.removeAllHighlights(),this.plugin.settings.presets.forEach(e=>{let t=document.querySelector(e);t instanceof HTMLElement&&(t.classList.remove("blur-plugin-preset","blur-plugin-hover"),t.classList.add("element-highlight-error"))}),document.querySelectorAll('[style*="outline"]').forEach(e=>{e instanceof HTMLElement&&this.plugin.isManagePanelElement(e)&&e.classList.add("element-highlight-error")})}};var c=require("obsidian");var d=class extends c.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName("Blur amount").setDesc("Set the amount of blur (in em)").addText(n=>n.setPlaceholder("0.5em").setValue(this.plugin.settings.blurAmount).onChange(async s=>{this.plugin.settings.blurAmount=s,await this.plugin.saveSettings(),this.plugin.settings.isBlurActive&&this.plugin.blurManager.applyBlurEffects()})),new c.Setting(t).setName("Manage presets").setDesc("Open the preset management panel").addButton(n=>n.setButtonText("Open panel").onClick(()=>{var s;this.plugin.blurPanel||(this.plugin.blurPanel=new u(this.plugin),(s=this.plugin.blurPanel)==null||s.open())})),new c.Setting(t).setName("Current keywords").setHeading();let i=t.createEl("ul");this.plugin.settings.keywords.forEach(n=>{i.createEl("li",{text:n})}),new c.Setting(t).setName("Debug mode").setDesc("Enable debug mode to show console logs").addToggle(n=>n.setValue(this.plugin.settings.isDebugMode).onChange(async s=>{this.plugin.settings.isDebugMode=s,await this.plugin.saveSettings()}))}};var h=class{constructor(e){this.plugin=e}debug(...e){this.plugin.settings.isDebugMode&&console.log("[Blur Debug]",...e)}error(...e){console.error("[Blur Error]",...e)}info(...e){this.plugin.settings.isDebugMode&&console.info("[Blur Info]",...e)}};var m=class extends v.Plugin{constructor(){super(...arguments);this.blurPanel=null}async onload(){this.logger=new h(this),await this.loadSettings(),this.settings.isSelectingMode=!1,await this.saveSettings(),this.blurManager=new p(this),this.addRibbonIcon("eye-off","Blur mode",i=>{i.button===0?(this.settings.isBlurActive=!this.settings.isBlurActive,this.settings.isBlurActive?this.blurManager.applyBlurEffects():this.blurManager.removeBlurEffects(),this.saveSettings()):i.button===2&&(this.blurPanel||(this.blurPanel=new u(this),this.blurPanel.open(),this.settings.isSelectingMode=!0,this.saveSettings()))}).addEventListener("contextmenu",i=>{i.preventDefault()}),this.addSettingTab(new d(this.app,this)),this.addCommand({id:"toggle-blur",name:"Toggle   effect",callback:()=>{this.settings.isBlurActive=!this.settings.isBlurActive,this.settings.isBlurActive?this.blurManager.applyBlurEffects():this.blurManager.removeBlurEffects(),this.saveSettings()}}),this.addCommand({id:"open-blur-panel",name:"Open management panel",callback:()=>{this.blurPanel||(this.blurPanel=new u(this),this.blurPanel.open(),this.settings.isSelectingMode=!0,this.saveSettings())}}),this.registerDomEvent(document,"click",this.handleClick.bind(this)),this.settings.isBlurActive&&this.blurManager.applyBlurEffects()}async loadSettings(){this.settings=Object.assign({},f,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}handleClick(t){if(!this.settings.isSelectingMode)return;let i=t.target;i&&this.blurManager.togglePresetElement(i)}onunload(){this.blurManager.removeBlurEffects(),document.querySelectorAll(".blur-plugin-preset, .blur-plugin-hover, .blur-plugin-selecting").forEach(t=>{t.classList.remove("blur-plugin-preset","blur-plugin-hover","blur-plugin-selecting")}),this.blurPanel&&this.blurPanel.close()}isEditorElement(t){return o.isEditorElement(t)}isRibbonElement(t){return o.isRibbonElement(t)}isManagePanelElement(t){return o.isManagePanelElement(t)}};

/* nosourcemap */